# golangci-lint configuration for DevOps MCP
# Optimized for large Go workspace with multiple modules

# Options for analysis running
run:
  # Timeout for analysis, default is 1m
  timeout: 10m
  
  # Exit code when at least one issue was found, default is 1
  issues-exit-code: 1
  
  # Include test files or not, default is true
  tests: true
  
  # List of build tags, all linters use it. Default is empty list.
  build-tags:
    - integration
  
  # Which dirs to skip: issues from them won't be reported.
  # Can use regexp here: `generated.*`, regexp is applied on full path.
  # Default value is empty list.
  skip-dirs:
    - vendor
    - generated
    - mocks
    - testdata
  
  # Which files to skip: they will be analyzed, but issues from them won't be reported.
  # Default value is empty list.
  skip-files:
    - ".*\\.pb\\.go$"
    - ".*\\.gen\\.go$"
  
  # Allow multiple parallel golangci-lint instances running.
  # If false (default) - golangci-lint acquires file lock on start.
  allow-parallel-runners: true

# Output configuration options
output:
  # Colored output
  print-issued-lines: true
  print-linter-name: true
  
  # Format of output: colored-line-number|line-number|json|tab|checkstyle|code-climate
  formats:
    - format: colored-line-number
      path: stdout

# All available settings of specific linters
linters-settings:
  errcheck:
    # Report about not checking of errors in type assertions
    check-type-assertions: true
    
    # Report about assignment of errors to blank identifier
    check-blank: true
  
  govet:
    # Report about shadowed variables
    check-shadowing: true
    
    # Settings per analyzer
    settings:
      printf:
        funcs:
          - (github.com/golangci/golangci-lint/pkg/logutils.Log).Infof
          - (github.com/golangci/golangci-lint/pkg/logutils.Log).Warnf
          - (github.com/golangci/golangci-lint/pkg/logutils.Log).Errorf
          - (github.com/golangci/golangci-lint/pkg/logutils.Log).Fatalf
  
  golint:
    # Minimal confidence for issues, default is 0.8
    min-confidence: 0.8
  
  gofmt:
    # Simplify code
    simplify: true
  
  goimports:
    # Put imports beginning with prefix after 3rd-party packages
    local-prefixes: github.com/S-Corkum/devops-mcp
  
  gocyclo:
    # Minimal code complexity to report, 30 by default (but we recommend 10-20)
    min-complexity: 15
  
  dupl:
    # Tokens count to trigger issue, 150 by default
    threshold: 150
  
  goconst:
    # Minimal length of string constant, 3 by default
    min-len: 3
    # Minimal occurrences count to trigger, 3 by default
    min-occurrences: 3
  
  misspell:
    # Correct spellings using locale preferences for US or UK.
    locale: US
  
  lll:
    # Max line length, lines longer will be reported. Default is 120.
    line-length: 140
  
  unused:
    # Treat code as a program (not a library) and report unused exported identifiers
    check-exported: false
  
  unparam:
    # Inspect exported functions
    check-exported: true
  
  gosec:
    # Security settings
    severity: medium
    confidence: medium

linters:
  # Disable all linters, then enable specific ones
  disable-all: true
  enable:
    # Default linters
    - errcheck
    - gosimple
    - govet
    - ineffassign
    - staticcheck
    - typecheck
    - unused
    
    # Additional linters
    - bodyclose
    - dupl
    - goconst
    - gocyclo
    - gofmt
    - goimports
    - gosec
    - misspell
    - nakedret
    - prealloc
    - revive
    - unconvert
    - unparam
    
  # Run only fast linters from enabled linters set (first run won't be fast)
  fast: false

issues:
  # List of regexps of issue texts to exclude
  exclude:
    # Exclude error return value check for certain functions
    - "Error return value of .((os\\.)?std(out|err)\\..*|.*Close|.*Flush|os\\.Remove(All)?|.*print(f|ln)?|os\\.(Un)?Setenv|.*Rollback|.*Abort). is not checked"
    
    # Exclude certain gosec warnings
    - "G104: Errors unhandled"
    - "G204: Subprocess launched with variable"
    
    # Exclude certain staticcheck warnings
    - "SA1019: .*is deprecated"
    
    # Exclude test-related issues
    - "ineffective break statement. Did you mean to break out of the outer loop"
  
  # Excluding configuration per-path, per-linter, per-text and per-source
  exclude-rules:
    # Exclude some linters from running on tests files
    - path: _test\.go
      linters:
        - gocyclo
        - errcheck
        - dupl
        - gosec
        - goconst
    
    # Exclude known test data patterns
    - path: testdata/
      linters:
        - gosec
        - errcheck
    
    # Exclude vendor
    - path: vendor/
      linters:
        - gosec
        - errcheck
        - dupl
        - goconst
    
    # Exclude generated files
    - path: ".*\\.gen\\.go"
      linters:
        - gosec
        - errcheck
        - dupl
        - goconst
    
    # Exclude certain patterns in migration files
    - path: migrations/
      linters:
        - gosec
    
    # Exclude mock files
    - path: mock.*\.go
      linters:
        - dupl
        - unused
  
  # Maximum issues count per one linter. Set to 0 to disable. Default is 50.
  max-issues-per-linter: 0
  
  # Maximum count of issues with the same text. Set to 0 to disable. Default is 3.
  max-same-issues: 0
  
  # Show only new issues: if there are unstaged changes or untracked files,
  # only those changes are analyzed, else only changes in HEAD~ are analyzed.
  new: false
  
  # Fix found issues (if it's supported by the linter)
  fix: false

severity:
  # Default value is empty string.
  # Set the default severity for issues. If severity rules are defined and the issues
  # do not match or no severity is provided to the rule this will be the default
  # severity applied.
  default-severity: warning

  # The default value is false.
  # If set to true severity-rules regular expressions become case sensitive.
  case-sensitive: false

  # Default value is empty list.
  # When a list of severity rules are provided, severity information will be added to lint
  # issues. Severity rules have the same filtering capability as exclude rules except you
  # are allowed to specify one matcher per severity rule.
  rules:
    - linters:
        - dupl
      severity: info