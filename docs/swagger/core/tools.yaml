paths:
  /tools:
    get:
      tags:
        - Tools
      summary: List available tools
      description: |
        Returns a list of all available DevOps tools with their descriptions, available actions,
        and safety restrictions. This endpoint helps discover what tools are integrated and
        what capabilities they provide.
      operationId: listTools
      responses:
        '200':
          description: Tool list with HATEOAS links
          content:
            application/json:
              schema:
                type: object
                required:
                  - tools
                  - _links
                properties:
                  tools:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        description:
                          type: string
                        actions:
                          type: array
                          items:
                            type: string
                        safety_notes:
                          type: string
                  _links:
                    type: object
                    additionalProperties:
                      type: string
        '401':
          $ref: '../common/responses.yaml#/components/responses/Unauthorized'
        '500':
          $ref: '../common/responses.yaml#/components/responses/InternalServerError'

  /tools/{tool}:
    parameters:
      - $ref: '../common/parameters.yaml#/components/parameters/ToolName'
    
    get:
      tags:
        - Tools
      summary: Get tool details
      description: |
        Returns detailed information about a specific tool including its capabilities,
        version, configuration requirements, and safety restrictions.
      operationId: getToolDetails
      responses:
        '200':
          description: Tool details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolDetails'
        '401':
          $ref: '../common/responses.yaml#/components/responses/Unauthorized'
        '404':
          $ref: '../common/responses.yaml#/components/responses/NotFound'
        '500':
          $ref: '../common/responses.yaml#/components/responses/InternalServerError'

  /tools/{tool}/actions:
    parameters:
      - $ref: '../common/parameters.yaml#/components/parameters/ToolName'
    
    get:
      tags:
        - Tools
      summary: List tool actions
      description: |
        Returns all available actions for a specific tool, including allowed and
        disallowed actions based on safety restrictions.
      operationId: listToolActions
      responses:
        '200':
          description: Tool actions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolActionsResponse'
        '401':
          $ref: '../common/responses.yaml#/components/responses/Unauthorized'
        '404':
          $ref: '../common/responses.yaml#/components/responses/NotFound'
        '500':
          $ref: '../common/responses.yaml#/components/responses/InternalServerError'

  /tools/{tool}/actions/{action}:
    parameters:
      - $ref: '../common/parameters.yaml#/components/parameters/ToolName'
      - $ref: '../common/parameters.yaml#/components/parameters/ActionName'
    
    get:
      tags:
        - Tools
      summary: Get action details
      description: |
        Returns detailed information about a specific action including parameters,
        validation rules, and examples.
      operationId: getActionDetails
      responses:
        '200':
          description: Action details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionDetails'
        '401':
          $ref: '../common/responses.yaml#/components/responses/Unauthorized'
        '404':
          $ref: '../common/responses.yaml#/components/responses/NotFound'
        '500':
          $ref: '../common/responses.yaml#/components/responses/InternalServerError'
    
    post:
      tags:
        - Tools
      summary: Execute tool action
      description: |
        Executes a specific action on a tool. All executions are tracked with the provided
        context_id for audit and conversation history purposes.
      operationId: executeToolAction
      parameters:
        - $ref: '../common/parameters.yaml#/components/parameters/ContextIDQuery'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              description: Action-specific parameters
            examples:
              github_create_issue:
                summary: Create GitHub issue
                value:
                  owner: "octocat"
                  repo: "hello-world"
                  title: "Bug in login form"
                  body: "The login form doesn't submit when using Safari"
                  labels: ["bug", "frontend"]
      responses:
        '200':
          description: Action executed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionExecutionResponse'
        '400':
          $ref: '../common/responses.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../common/responses.yaml#/components/responses/Unauthorized'
        '403':
          $ref: '../common/responses.yaml#/components/responses/Forbidden'
        '404':
          $ref: '../common/responses.yaml#/components/responses/NotFound'
        '422':
          $ref: '../common/responses.yaml#/components/responses/UnprocessableEntity'
        '500':
          $ref: '../common/responses.yaml#/components/responses/InternalServerError'

  /tools/{tool}/queries:
    parameters:
      - $ref: '../common/parameters.yaml#/components/parameters/ToolName'
    
    post:
      tags:
        - Tools
      summary: Query tool data
      description: |
        Performs a query operation on a tool to retrieve data without making changes.
        This is used for read-only operations like listing resources or getting status.
      operationId: queryToolData
      parameters:
        - $ref: '../common/parameters.yaml#/components/parameters/ContextIDQuery'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              description: Query parameters specific to the tool
            examples:
              list_repositories:
                summary: List GitHub repositories
                value:
                  query_type: "list_repositories"
                  filters:
                    organization: "octocat"
                    visibility: "public"
                    sort: "updated"
      responses:
        '200':
          description: Query results
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string
                  tool:
                    type: string
                  query_params:
                    type: object
                  data:
                    type: array
                    items:
                      type: object
        '400':
          $ref: '../common/responses.yaml#/components/responses/BadRequest'
        '401':
          $ref: '../common/responses.yaml#/components/responses/Unauthorized'
        '404':
          $ref: '../common/responses.yaml#/components/responses/NotFound'
        '500':
          $ref: '../common/responses.yaml#/components/responses/InternalServerError'

components:
  schemas:

    ToolDetails:
      allOf:
        - $ref: '../common/schemas.yaml#/components/schemas/ToolCapability'
        - type: object
          properties:
            category:
              type: string
              enum: [scm, ci_cd, security, artifacts, monitoring]
              description: Tool category
            authentication:
              type: object
              properties:
                type:
                  type: string
                  enum: [api_key, oauth2, basic, token]
                required_scopes:
                  type: array
                  items:
                    type: string
              description: Authentication requirements
            configuration:
              type: object
              properties:
                required:
                  type: array
                  items:
                    type: string
                optional:
                  type: array
                  items:
                    type: string
              description: Configuration parameters
            rate_limits:
              type: object
              properties:
                requests_per_hour:
                  type: integer
                concurrent_requests:
                  type: integer
              description: Tool-specific rate limits
            health_status:
              type: string
              enum: [healthy, degraded, unavailable]
              description: Current tool health status

    ToolActionsResponse:
      type: object
      required:
        - tool
        - allowed_actions
      properties:
        tool:
          type: string
          example: "github"
        allowed_actions:
          type: array
          items:
            type: string
          description: Actions permitted by safety policy
        disallowed_actions:
          type: array
          items:
            type: string
          description: Actions blocked by safety policy
        safety_notes:
          type: string
          description: Explanation of safety restrictions
        action_groups:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
          description: Actions grouped by type
          example:
            read: ["get_issue", "list_issues", "get_repository"]
            write: ["create_issue", "update_issue", "create_pull_request"]
            admin: ["archive_repository", "update_settings"]

    ActionDetails:
      allOf:
        - $ref: '../common/schemas.yaml#/components/schemas/ToolAction'
        - type: object
          properties:
            input_schema:
              type: object
              description: JSON Schema for action parameters
            output_schema:
              type: object
              description: JSON Schema for action response
            examples:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                  description:
                    type: string
                  input:
                    type: object
                  output:
                    type: object
              description: Example requests and responses
            error_codes:
              type: array
              items:
                type: object
                properties:
                  code:
                    type: string
                  description:
                    type: string
                  recovery:
                    type: string
              description: Possible error codes and recovery suggestions
            rate_limit:
              type: object
              properties:
                requests_per_hour:
                  type: integer
                burst:
                  type: integer
              description: Action-specific rate limits
            _links:
              $ref: '../common/schemas.yaml#/components/schemas/Links'

    ActionExecutionResponse:
      type: object
      required:
        - status
        - tool
        - action
      properties:
        status:
          type: string
          enum: [success, failure]
        message:
          type: string
          description: Human-readable status message
        tool:
          type: string
          example: "github"
        action:
          type: string
          example: "create_issue"
        params:
          type: object
          description: Parameters used for execution
        result:
          type: object
          additionalProperties: true
          description: Action-specific result data
        execution_time:
          type: number
          format: float
          description: Execution time in seconds
        _links:
          $ref: '../common/schemas.yaml#/components/schemas/Links'

        total:
          type: integer
          description: Total number of results
        meta:
          $ref: '../common/schemas.yaml#/components/schemas/PaginationMeta'
        _links:
          $ref: '../common/schemas.yaml#/components/schemas/Links'